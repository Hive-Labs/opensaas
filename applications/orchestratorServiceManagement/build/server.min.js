/*! notoja-orchestrator_service 2013-07-14 */
function pingComputer(){console.log(new Date-runnerList[runnerIndex].ping),new Date-runnerList[runnerIndex].ping>FIVE_MINUTES&&console.log("Computer "+runnerIndex+" is dead..."),runnerIndex<runnerList.length-1?(runnerIndex=0,runnerIndex++):(runnerIndex=0,runnerList=runners.list()),setImmediate(pingComputer)}var express=require("express"),routes=require("./routes"),dbService=require("dbService"),runnersRoute=require("./routes/runnersRoute"),runners=require("./runners"),http=require("http"),engine=require("ejs-locals"),path=require("path"),fs=require("fs");if(!fs.existsSync("./ServerConfiguration.json"))throw new Error("Server configuration file has not been specified. I am checking process.env.SERVERCONF");fs.readFile("./ServerConfiguration.json","utf8",function(a,b){return a?(console.log("Error: "+a),void 0):(b=JSON.parse(b),dbService.init(b.dbService),void 0)});var app=express();app.set("port",process.env.PORT||3e3),app.set("views",__dirname+"/views"),app.set("view engine","ejs"),app.engine("ejs",engine),app.use(express.favicon()),app.use(express.logger("dev")),app.use(express.bodyParser()),app.use(express.methodOverride()),app.use(app.router),app.use(express.static(__dirname+"/public")),"development"==app.get("env")&&app.use(express.errorHandler()),app.get("/",routes.index),app.get("/runners/list",runnersRoute.list),app.post("/runners/ping",runnersRoute.ping),app.post("/runners/add",runnersRoute.add),http.createServer(app).listen(app.get("port"),function(){console.log("Orchestrator Service listening on port "+app.get("port"))});var runnerList=runners.list(),runnerIndex=0,FIVE_MINUTES=3e3;pingComputer();